<!-- CSS DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
<style>
    .dipapok-wrapper {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 100%;
        margin: 0 auto;
    }

    .dipapok-header {
        text-align: center;
        margin-bottom: 1.5rem;
        padding: 2rem 1rem;
        background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
        color: white;
        border-radius: 8px;
    }

    .dipapok-header h2 {
        margin: 0 0 0.5rem 0;
        font-size: 1.8rem;
        color: white !important;
    }

    .dipapok-header p {
        margin: 0;
        opacity: 0.9;
        font-size: 0.95rem;
    }

    .dipapok-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        border-bottom: 2px solid #e2e8f0;
        overflow-x: auto;
        padding-bottom: 2px;
    }

    .tab-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        background: none;
        font-weight: 600;
        color: #64748b;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .tab-btn:hover {
        color: #7c3aed;
        background-color: #f5f3ff;
        border-radius: 4px 4px 0 0;
    }

    .tab-btn.active {
        color: #7c3aed;
        border-bottom-color: #7c3aed;
    }

    #tabelDipaPok {
        width: 100% !important;
        font-size: 0.9rem;
    }

    #tabelDipaPok thead th {
        background: #7c3aed;
        color: white;
        padding: 12px 10px;
        text-align: left;
        font-weight: 600;
        white-space: nowrap;
    }

    #tabelDipaPok tbody td {
        padding: 12px 10px;
        vertical-align: middle;
        border-bottom: 1px solid #e5e7eb;
    }

    #tabelDipaPok tbody tr:hover {
        background-color: #f5f3ff;
    }

    .currency {
        font-family: 'Courier New', Courier, monospace;
        font-weight: 600;
        white-space: nowrap;
    }

    .btn-pdf {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 6px;
        text-decoration: none;
        transition: all 0.2s;
    }

    .btn-pdf.dipa {
        background-color: #eff6ff;
        color: #2563eb;
    }

    .btn-pdf.dipa:hover {
        background-color: #2563eb;
        color: white;
    }

    .btn-pdf.pok {
        background-color: #ecfdf5;
        color: #059669;
    }

    .btn-pdf.pok:hover {
        background-color: #059669;
        color: white;
    }

    .badge-revisi {
        background: #fef3c7;
        color: #92400e;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .text-center {
        text-align: center;
    }

    .text-right {
        text-align: right;
    }

    @media (max-width: 768px) {
        #tabelDipaPok {
            font-size: 0.8rem;
        }
        .currency {
            font-size: 0.8rem;
        }
    }
</style>

<div class="dipapok-wrapper">
    <div class="dipapok-header">
        <h2>Petikan DIPA & POK</h2>
        <p>Dokumen Anggaran dan Rincian Kertas Kerja - PA Penajam</p>
    </div>

    <div class="dipapok-tabs" id="yearTabs">
        <button class="tab-btn active" data-year="2026">2026</button>
        <button class="tab-btn" data-year="2025">2025</button>
        <button class="tab-btn" data-year="2024">2024</button>
    </div>

    <div style="overflow-x:auto; margin-top: 1rem;">
        <table id="tabelDipaPok" class="display" style="width:100%">
            <thead>
                <tr>
                    <th style="width: 5%">No</th>
                    <th style="width: 10%">Tahun DIPA</th>
                    <th style="width: 15%">Revisi</th>
                    <th style="width: 25%">Jenis DIPA</th>
                    <th style="width: 15%">Tanggal DIPA</th>
                    <th style="width: 20%">Alokasi (Rp)</th>
                    <th style="width: 5%">DIPA</th>
                    <th style="width: 5%">POK</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="8" style="text-align:center;">Memuat data...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
    (function () {
        const API_URL = 'https://web-api.pa-penajam.go.id/api/dipapok';

        let table;
        let currentYear = '2026';

        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatTanggal(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            } catch (e) {
                return dateStr;
            }
        }

        function initDataTable(year) {
            if (table) {
                table.destroy();
            }

            const url = `${API_URL}?tahun=${year}`;

            table = $('#tabelDipaPok').DataTable({
                ajax: {
                    url: url,
                    dataSrc: function (json) {
                        return json.data || [];
                    },
                    error: function () {
                        $('#tabelDipaPok tbody').html('<tr><td colspan="8" class="text-center">Gagal memuat data.</td></tr>');
                    }
                },
                columns: [
                    {
                        data: null,
                        render: function (data, type, row, meta) {
                            return meta.row + 1;
                        }
                    },
                    { 
                        data: 'thn_dipa',
                        render: function(data) {
                            return '<strong>' + data + '</strong>';
                        }
                    },
                    { 
                        data: 'revisi_dipa',
                        render: function(data) {
                            return '<span class="badge-revisi">' + data + '</span>';
                        }
                    },
                    { data: 'jns_dipa' },
                    { 
                        data: 'tgl_dipa',
                        render: function(data) {
                            return formatTanggal(data);
                        }
                    },
                    { 
                        data: 'alokasi_dipa',
                        render: function(data) {
                            return '<span class="currency">' + formatRupiah(data) + '</span>';
                        }
                    },
                    {
                        data: 'doc_dipa',
                        render: function(data) {
                            if (data && data !== '') {
                                return '<a href="' + data + '" target="_blank" class="btn-pdf dipa" title="Lihat Dokumen DIPA">' +
                                    '<i class="fa-solid fa-file-pdf"></i>' +
                                    '</a>';
                            }
                            return '-';
                        }
                    },
                    {
                        data: 'doc_pok',
                        render: function(data) {
                            if (data && data !== '') {
                                return '<a href="' + data + '" target="_blank" class="btn-pdf pok" title="Lihat Dokumen POK">' +
                                    '<i class="fa-solid fa-file-pdf"></i>' +
                                    '</a>';
                            }
                            return '-';
                        }
                    }
                ],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/id.json'
                },
                pageLength: 25,
                ordering: true,
                order: [[0, 'desc']],
                dom: 'rt<"bottom"ip><"clear">',
            });
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentYear = this.getAttribute('data-year');
                initDataTable(currentYear);
            });
        });

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => initDataTable(currentYear));
        } else {
            initDataTable(currentYear);
        }
    })();
</script>
